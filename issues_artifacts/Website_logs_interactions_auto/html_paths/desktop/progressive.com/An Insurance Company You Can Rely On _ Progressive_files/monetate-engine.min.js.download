async function postMonetateEngine(n=[]){const t={customerId:GetCookie("mt.SITESERVER")??undefined,monetateId:GetCookie("mt.v")??undefined,channel:window.monetateChannel??"",events:n},i=await fetch("https://engine.monetate.net/api/engine/v1/decide/progressive",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});try{return i.json()}catch(r){throw new Error(r);}}function recordProductDetailView(n){const t=Array.isArray(n)?n:[];n.productId?t.push(n):typeof n=="string"&&t.push({productId:n});postMonetateEngine([{eventType:"monetate:decision:DecisionRequest",requestId:`recommendation_test_${(new Date).getTime()}`,includeReporting:!0},{eventType:"monetate:context:ProductDetailView",products:t},])}function recordRecommendation(n,t){const u=document.querySelectorAll("a[data-qs-product][data-monetate-rec]"),i=[],r=[],f=n=>{const i=[{eventType:"monetate:record:RecImpressions",recImpressions:n}];return t&&i.push({eventType:"monetate:record:Impressions",impressionIds:[t]}),postMonetateEngine(i)},e=n=>postMonetateEngine([{eventType:"monetate:record:RecClicks",recClicks:n},]);u.forEach(t=>{const f=t.getAttribute("data-qs-product"),u=n.find(n=>n.id===f);u&&(r.push(f),i.push(u.recToken),t.addEventListener("click",()=>{e([u.recToken])}))});f(i);const o=r.join(", ");_gaObj.GATrackEvent(null,"SysEvent","productRecoResponse",null,!0,{dataValue:o},!1)}async function monetateOmnichannelRequest({id:t,customVars:n,onResponse:i}){const r=[{eventType:"monetate:decision:DecisionRequest",requestId:`${t}_${(new Date).getTime()}`,includeReporting:!0},];n&&r.push({eventType:"monetate:context:CustomVariables",customVariables:convertCustomVars(n)});try{const t=await postMonetateEngine(r);t.meta.errors?.forEach(n=>{const[i,t]=Object.entries(n)[0];if(t!=="Missing Endpoint Url")throw new Error(`${i}: ${t}`);});const u=t.data?.responses?.[0]?.actions,n=u?.find(({actionType:n})=>n==="monetate:action:OmnichannelJson");if(i(n?.json),n&&typeof _gaObj!="undefined"){const{experience_id:t,experience_name:i,variant_label:r}=n.impressionReporting[0],u=`${i}-${t}=${r}`;_gaObj.GATrackEvent("progCom","Monetate",u,window.monetateTime,!0,{HTTPStatus:window.monetateCode})}}catch(u){throw new Error(u);}}function convertCustomVars(n){return Array.isArray(n)&&n.length>0?n:Object.values(n).length>0?Object.entries(n).reduce((n,[i,t])=>[...n,{variable:i,value:t}],[]):[]}